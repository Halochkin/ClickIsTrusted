<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test of ClickIsTrusted</title>
</head>
<body>
<h1>dblclick to run the test.</h1>

<input type="text" value="hello sunshine!">
<script>

  window.addEventListener("keydown", function (e) {
    console.log(
      e.type,
      e.isTrusted,
      e.composed,
      e.bubbles,
      e.key === "a",
      e.code === "KeyA",
      // e.keyCode === 0, //this isn't set


      !e.getModifierState("Alt"),
      !e.getModifierState("Shift"),
      !e.getModifierState("Meta"),
      !e.getModifierState("Control"),
      e.target === input,
      e);
  });

  function run() {

    const input = document.querySelector("input");
    input.focus();

    setTimeout(function () {
      const keyA = new KeyboardEvent("keydown-is-trusted", {
        key: "a",
        code: "KeyA",
        // shiftKey: 1,
      });
      keyA.text = "a";
      keyA.keyIdentifier = 'U+0061';
      keyA.unmodifiedText = "a";
      keyA.isKeyPad = 0;
      keyA.isSystemKey = 0;
      keyA.nativeVirtualKeyCode = 97;
      keyA.windowsVirtualKeyCode = 97;
      keyA.macVirtualKeyCode = 97;
      window.dispatchEvent(keyA);
    }, 0);

    setTimeout(function () {
      window.addEventListener("keydown", function (e) {
        console.log(
          e.type,
          e.isTrusted,
          e.composed,
          e.bubbles,
          e.key === "b",
          e.code === "KeyB",
          // e.keyCode === 0, //this isn't set


          !e.getModifierState("Alt"),
          !e.getModifierState("Shift"),
          !e.getModifierState("Meta"),
          !e.getModifierState("Control"),
          e.target === input,
          e);
      }, {capture: true, once: true});
      const keyB = new KeyboardEvent("rawkeydown-is-trusted", {
        key: "b",
        code: "KeyB",
        // shiftKey: 1,
      });
      keyB.text = "b";
      keyB.keyIdentifier = 'U+0062';
      keyB.unmodifiedText = "b";
      keyB.isKeyPad = 0;
      keyB.isSystemKey = 0;
      keyB.nativeVirtualKeyCode = 98;
      keyB.windowsVirtualKeyCode = 98;
      keyB.macVirtualKeyCode = 98;
      window.dispatchEvent(keyB);
    }, 17);

    setTimeout(function () {
      window.addEventListener("keydown", function (e) {
        console.log(
          e.type,
          e.isTrusted,
          e.composed,
          e.bubbles,
          e.key === "c",
          e.code === "KeyC",
          // e.keyCode === 0, //this isn't set


          !e.getModifierState("Alt"),
          !e.getModifierState("Shift"),
          !e.getModifierState("Meta"),
          !e.getModifierState("Control"),
          e.target === input,
          e);
      }, {capture: true, once: true});
      const keyC = new KeyboardEvent("char-is-trusted", {
        key: "c",
        code: "KeyC",
        // shiftKey: 1,
      });
      keyC.text = "c";
      keyC.keyIdentifier = 'U+0063';
      keyC.unmodifiedText = "c";
      keyC.isKeyPad = 0;
      keyC.isSystemKey = 0;
      keyC.nativeVirtualKeyCode = 99;
      keyC.windowsVirtualKeyCode = 99;
      keyC.macVirtualKeyCode = 99;
      window.dispatchEvent(keyC);
    }, 34);
  }

  window.addEventListener("dblclick", run);
</script>
</body>
</html>