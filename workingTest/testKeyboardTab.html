<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test of ClickIsTrusted</title>
</head>
<body>
<h1>dblclick to run the test.</h1>

<a href="#sunshine">hello</a>
<a href="#again">again</a>
<a href="#again2">and again</a>
<script>

  function run() {

    const a = document.querySelector("a");
    a.focus();

    setTimeout(function () {
      window.addEventListener("keydown", function (e) {
        console.log(
          e.type,
          e.isTrusted,
          e.composed,
          e.bubbles,
          e.key === "Tab",
          e.code === "Tab",
          // e.keyCode === 0, //this isn't set


          !e.getModifierState("Alt"),
          !e.getModifierState("Shift"),
          !e.getModifierState("Meta"),
          !e.getModifierState("Control"),
          e.target === a,
          e);
      }, {capture: true, once: true});
      const Enter = new KeyboardEvent("keydown-is-trusted", {
        key: "Tab",
        code: "Tab",
        // shiftKey: 1,
      });
      Enter.text = "\t";
      Enter.keyIdentifier = 'U+0009';
      Enter.unmodifiedText = "\t";
      Enter.isKeyPad = 0;
      Enter.isSystemKey = 0;
      Enter.nativeVirtualKeyCode = 9;
      Enter.windowsVirtualKeyCode = 9;
      Enter.macVirtualKeyCode = 9;
      window.dispatchEvent(Enter);
    }, 0);

    setTimeout(function () {
      window.addEventListener("keydown", function (e) {
        console.log(
          e.type,
          e.isTrusted,
          e.composed,
          e.bubbles,
          e.key === "Tab",
          e.code === "Tab",
          // e.keyCode === 0, //this isn't set


          !e.getModifierState("Alt"),
          !e.getModifierState("Shift"),
          !e.getModifierState("Meta"),
          !e.getModifierState("Control"),
          e.target === a,
          e);
      }, {capture: true, once: true});
      const Enter = new KeyboardEvent("rawkeydown-is-trusted", {
        key: "Tab",
        code: "Tab",
        // shiftKey: 1,
      });
      Enter.text = "\t";
      Enter.keyIdentifier = 'U+0009';
      Enter.unmodifiedText = "\t";
      Enter.isKeyPad = 0;
      Enter.isSystemKey = 0;
      Enter.nativeVirtualKeyCode = 9;
      Enter.windowsVirtualKeyCode = 9;
      Enter.macVirtualKeyCode = 9;
      window.dispatchEvent(Enter);
    }, 100);

  }

  window.addEventListener("dblclick", run);
</script>
</body>
</html>